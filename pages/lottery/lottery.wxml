<!--pages/lottery/lottery.wxml-->
<view class="container">
  <view class="header">
    <text class="title">ğŸ‰ å¹¸è¿å¤§è½¬ç›˜ ğŸ‰</text>
    <text class="subtitle">ä»Šæ—¥å‰©ä½™æŠ½å¥–æ¬¡æ•°ï¼š{{lotteryCount}} æ¬¡</text>
  </view>

  <view class="lottery-section">
    <view class="wheel-container">
      <view class="wheel" style="transform: rotate({{rotateAngle}}deg);">
        <view 
          wx:for="{{prizes}}" 
          wx:key="id" 
          class="prize-item"
          style="transform: rotate({{index * 60}}deg); background-color: {{item.color}};"
        >
          <view class="prize-content" style="transform: rotate(-{{index * 60}}deg);">
            <text class="prize-icon">{{item.icon}}</text>
            <text class="prize-name">{{item.name}}</text>
          </view>
        </view>
      </view>
      
      <view class="pointer">ğŸ“</view>
      
      <button 
        class="lottery-btn {{isDrawing ? 'drawing' : ''}}" 
        bindtap="startLottery"
        disabled="{{isDrawing || lotteryCount <= 0}}"
      >
        <text wx:if="{{!isDrawing}}">{{lotteryCount > 0 ? 'å¼€å§‹æŠ½å¥–' : 'æ¬¡æ•°ç”¨å®Œ'}}</text>
        <text wx:else>æŠ½å¥–ä¸­...</text>
      </button>
    </view>
  </view>

  <view class="actions">
    <button class="action-btn" bindtap="getMoreChances">è·å–æ›´å¤šæœºä¼š</button>
    <button class="action-btn" bindtap="viewRecords">ä¸­å¥–è®°å½•</button>
    <button class="action-btn" bindtap="viewRules">æŠ½å¥–è§„åˆ™</button>
  </view>

  <view class="records-section" wx:if="{{winRecords.length > 0}}">
    <view class="section-title">æœ€è¿‘ä¸­å¥–è®°å½•</view>
    <scroll-view scroll-y="true" class="records-list">
      <view wx:for="{{winRecords}}" wx:key="id" class="record-item">
        <view class="record-info">
          <text class="record-prize">{{item.prize.icon}} {{item.prize.name}}</text>
          <text class="record-date">{{item.date}}</text>
        </view>
        <button class="use-btn {{item.used ? 'used' : ''}}" data-id="{{item.id}}" bindtap="usePrize" disabled="{{item.used}}">
          {{item.used ? 'å·²ä½¿ç”¨' : 'ä½¿ç”¨'}}
        </button>
      </view>
    </scroll-view>
  </view>

  <view class="result-mask" wx:if="{{showResult}}" bindtap="closeResult">
    <view class="result-dialog" catchtap="">
      <view class="result-header">
        <text class="result-title">ğŸŠ æ­å–œä¸­å¥– ğŸŠ</text>
      </view>
      <view class="result-content">
        <view class="prize-display">
          <text class="prize-big-icon">{{currentPrize.icon}}</text>
          <text class="prize-big-name">{{currentPrize.name}}</text>
          <text class="prize-big-desc">{{currentPrize.description}}</text>
        </view>
      </view>
      <view class="result-footer">
        <button class="confirm-btn" bindtap="closeResult">ç¡®è®¤</button>
      </view>
    </view>
  </view>
</view>