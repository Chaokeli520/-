# å¾®ä¿¡äº‘å¼€å‘æ•°æ®åº“è®¾è®¡

## ğŸ“Š æ•°æ®åº“æ¦‚è§ˆ

äº¬è¥¿æ™ºè°·èŒ¶è¯­å ‚å°ç¨‹åºä½¿ç”¨å¾®ä¿¡äº‘å¼€å‘çš„äº‘æ•°æ®åº“ï¼Œé‡‡ç”¨ NoSQL æ–‡æ¡£æ•°æ®åº“ã€‚

## ğŸ—‚ï¸ æ•°æ®è¡¨ç»“æ„

### 1. usersï¼ˆç”¨æˆ·ä¿¡æ¯è¡¨ï¼‰

ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯å’Œç»Ÿè®¡æ•°æ®ã€‚

```javascript
{
  _id: String,              // ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆçš„æ–‡æ¡£ID
  openid: String,           // å¾®ä¿¡ç”¨æˆ·å”¯ä¸€æ ‡è¯†
  appid: String,            // å°ç¨‹åºAppID
  unionid: String,          // å¾®ä¿¡å¼€æ”¾å¹³å°å”¯ä¸€æ ‡è¯†
  userInfo: Object,         // ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
  lotteryCount: Number,     // å‰©ä½™æŠ½å¥–æ¬¡æ•°
  totalOrderCount: Number,  // æ€»è®¢å•æ•°é‡
  totalSpent: Number,       // æ€»æ¶ˆè´¹é‡‘é¢
  totalLotteryCount: Number, // æ€»æŠ½å¥–æ¬¡æ•°
  level: String,            // ç”¨æˆ·ç­‰çº§ï¼šbronze, silver, gold, platinum
  createTime: Date,         // åˆ›å»ºæ—¶é—´
  updateTime: Date,         // æ›´æ–°æ—¶é—´
  lastLoginTime: Date       // æœ€åç™»å½•æ—¶é—´
}
```

### 2. ordersï¼ˆè®¢å•ä¿¡æ¯è¡¨ï¼‰

ç”¨æˆ·çš„è®¢å•è®°å½•ã€‚

```javascript
{
  _id: String,              // ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆçš„æ–‡æ¡£ID
  orderNo: String,          // è®¢å•å·
  openid: String,           // ä¸‹å•ç”¨æˆ·çš„openid
  appid: String,            // å°ç¨‹åºAppID
  unionid: String,          // å¾®ä¿¡å¼€æ”¾å¹³å°å”¯ä¸€æ ‡è¯†
  cart: Array,              // è´­ç‰©è½¦å•†å“åˆ—è¡¨
  totalAmount: Number,      // è®¢å•æ€»é‡‘é¢
  userInfo: Object,         // ä¸‹å•æ—¶çš„ç”¨æˆ·ä¿¡æ¯
  status: String,           // è®¢å•çŠ¶æ€ï¼špending, confirmed, preparing, ready, completed, cancelled
  createTime: Date,         // åˆ›å»ºæ—¶é—´
  updateTime: Date,         // æ›´æ–°æ—¶é—´
  remark: String            // è®¢å•å¤‡æ³¨
}
```

### 3. lottery_chancesï¼ˆæŠ½å¥–æœºä¼šè¡¨ï¼‰

ç”¨æˆ·è·å¾—æŠ½å¥–æœºä¼šçš„è®°å½•ã€‚

```javascript
{
  _id: String,              // ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆçš„æ–‡æ¡£ID
  openid: String,           // ç”¨æˆ·openid
  orderNo: String,          // å…³è”çš„è®¢å•å·
  lotteryCount: Number,     // è·å¾—çš„æŠ½å¥–æ¬¡æ•°
  createTime: Date,         // åˆ›å»ºæ—¶é—´
  source: String            // æ¥æºï¼šorderï¼ˆè®¢å•ï¼‰ï¼Œshareï¼ˆåˆ†äº«ï¼‰ï¼Œeventï¼ˆæ´»åŠ¨ï¼‰
}
```

### 4. lottery_recordsï¼ˆæŠ½å¥–è®°å½•è¡¨ï¼‰

ç”¨æˆ·çš„æŠ½å¥–å†å²è®°å½•ã€‚

```javascript
{
  _id: String,              // ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆçš„æ–‡æ¡£ID
  openid: String,           // ç”¨æˆ·openid
  prizeId: Number,          // å¥–å“ID
  prizeName: String,        // å¥–å“åç§°
  prizeIcon: String,        // å¥–å“å›¾æ ‡
  prizeType: String,        // å¥–å“ç±»å‹ï¼šrewardï¼ˆæœ‰å¥–å“ï¼‰ï¼Œnoneï¼ˆè°¢è°¢å‚ä¸ï¼‰
  wheelAngle: Number,       // è½¬ç›˜è§’åº¦
  used: Boolean,            // æ˜¯å¦å·²ä½¿ç”¨
  createTime: Date,         // åˆ›å»ºæ—¶é—´
  expireTime: Date,         // è¿‡æœŸæ—¶é—´
  useTime: Date             // ä½¿ç”¨æ—¶é—´
}
```

### 5. productsï¼ˆå•†å“ä¿¡æ¯è¡¨ï¼‰

èŒ¶é¥®å•†å“çš„åŸºæœ¬ä¿¡æ¯ã€‚

```javascript
{
  _id: String,              // ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆçš„æ–‡æ¡£ID
  id: Number,               // å•†å“ID
  categoryId: Number,       // åˆ†ç±»ID
  name: String,             // å•†å“åç§°
  description: String,      // å•†å“æè¿°
  price: Number,            // å•†å“ä»·æ ¼
  image: String,            // å•†å“å›¾ç‰‡URL
  hot: Boolean,             // æ˜¯å¦çƒ­é”€
  status: String,           // å•†å“çŠ¶æ€ï¼šactiveï¼ˆä¸Šæ¶ï¼‰ï¼Œinactiveï¼ˆä¸‹æ¶ï¼‰
  sort: Number,             // æ’åºæƒé‡
  createTime: Date,         // åˆ›å»ºæ—¶é—´
  updateTime: Date          // æ›´æ–°æ—¶é—´
}
```

### 6. categoriesï¼ˆå•†å“åˆ†ç±»è¡¨ï¼‰

èŒ¶é¥®å•†å“çš„åˆ†ç±»ä¿¡æ¯ã€‚

```javascript
{
  _id: String,              // ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆçš„æ–‡æ¡£ID
  id: Number,               // åˆ†ç±»ID
  name: String,             // åˆ†ç±»åç§°
  icon: String,             // åˆ†ç±»å›¾æ ‡
  sort: Number,             // æ’åºæƒé‡
  status: String,           // åˆ†ç±»çŠ¶æ€ï¼šactiveï¼ˆå¯ç”¨ï¼‰ï¼Œinactiveï¼ˆç¦ç”¨ï¼‰
  createTime: Date,         // åˆ›å»ºæ—¶é—´
  updateTime: Date          // æ›´æ–°æ—¶é—´
}
```

## ğŸ”’ æ•°æ®åº“æƒé™è®¾ç½®

### æƒé™è§„åˆ™

1. **ç”¨æˆ·æ•°æ®**ï¼šåªèƒ½è¯»å†™è‡ªå·±çš„æ•°æ®ï¼ˆopenid åŒ¹é…ï¼‰
2. **å•†å“æ•°æ®**ï¼šæ‰€æœ‰ç”¨æˆ·åªè¯»
3. **è®¢å•æ•°æ®**ï¼šåªèƒ½è¯»å†™è‡ªå·±çš„è®¢å•
4. **æŠ½å¥–æ•°æ®**ï¼šåªèƒ½è¯»å†™è‡ªå·±çš„æŠ½å¥–è®°å½•

### å®‰å…¨è§„åˆ™ç¤ºä¾‹

```javascript
// ç”¨æˆ·è¡¨æƒé™
{
  "read": "doc.openid == auth.openid",
  "write": "doc.openid == auth.openid"
}

// å•†å“è¡¨æƒé™
{
  "read": "true",
  "write": "false"
}
```

## ğŸ“ˆ ç´¢å¼•è®¾è®¡

### ä¸»è¦ç´¢å¼•

1. **ç”¨æˆ·è¡¨**
   - `openid` (å”¯ä¸€ç´¢å¼•)
   - `level` (æ™®é€šç´¢å¼•)

2. **è®¢å•è¡¨**
   - `openid` (æ™®é€šç´¢å¼•)
   - `status` (æ™®é€šç´¢å¼•)
   - `createTime` (é™åºç´¢å¼•)

3. **æŠ½å¥–è®°å½•è¡¨**
   - `openid` (æ™®é€šç´¢å¼•)
   - `createTime` (é™åºç´¢å¼•)
   - `used` (æ™®é€šç´¢å¼•)

4. **å•†å“è¡¨**
   - `categoryId` (æ™®é€šç´¢å¼•)
   - `hot` (æ™®é€šç´¢å¼•)

## ğŸš€ æ•°æ®åˆå§‹åŒ–

### 1. å•†å“åˆ†ç±»æ•°æ®

```javascript
// éœ€è¦åœ¨äº‘æ•°æ®åº“ä¸­æ‰‹åŠ¨æ·»åŠ 
[
  {id: 1, name: 'ç»å…¸å¥¶èŒ¶', sort: 1, status: 'active'},
  {id: 2, name: 'æ°´æœèŒ¶', sort: 2, status: 'active'},
  {id: 3, name: 'å’–å•¡ç³»åˆ—', sort: 3, status: 'active'},
  {id: 4, name: 'ç‰¹è°ƒé¥®å“', sort: 4, status: 'active'}
]
```

### 2. å•†å“æ•°æ®

```javascript
// éœ€è¦åœ¨äº‘æ•°æ®åº“ä¸­æ‰‹åŠ¨æ·»åŠ å•†å“æ•°æ®
// æˆ–è€…é€šè¿‡ç®¡ç†ç«¯å°ç¨‹åºè¿›è¡Œæ·»åŠ 
```

## ğŸ› ï¸ éƒ¨ç½²æ­¥éª¤

### 1. åˆ›å»ºäº‘æ•°æ®åº“

1. åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­æ‰“å¼€äº‘å¼€å‘æ§åˆ¶å°
2. ç‚¹å‡»"æ•°æ®åº“" â†’ "æ–°å»ºé›†åˆ"
3. æŒ‰ç…§ä¸Šè¿°ç»“æ„åˆ›å»ºå„ä¸ªé›†åˆ

### 2. è®¾ç½®æƒé™

1. åœ¨äº‘å¼€å‘æ§åˆ¶å°ä¸­ï¼Œä¸ºæ¯ä¸ªé›†åˆè®¾ç½®æƒé™
2. å¤åˆ¶ `collections.json` ä¸­çš„æƒé™è§„åˆ™
3. åº”ç”¨åˆ°å¯¹åº”çš„é›†åˆ

### 3. åˆ›å»ºç´¢å¼•

1. åœ¨é›†åˆç®¡ç†é¡µé¢ç‚¹å‡»"ç´¢å¼•"
2. æ ¹æ® `collections.json` ä¸­çš„ç´¢å¼•é…ç½®åˆ›å»ºç´¢å¼•
3. æå‡æŸ¥è¯¢æ€§èƒ½

### 4. åˆå§‹åŒ–æ•°æ®

1. æ‰‹åŠ¨æ·»åŠ å•†å“åˆ†ç±»æ•°æ®
2. æ·»åŠ å•†å“åŸºç¡€æ•°æ®
3. æµ‹è¯•æ•°æ®åº“è¿æ¥å’Œæƒé™

## ğŸ’¡ ä½¿ç”¨å»ºè®®

1. **å®šæœŸå¤‡ä»½**ï¼šå»ºè®®å®šæœŸå¤‡ä»½é‡è¦æ•°æ®
2. **ç›‘æ§å®¹é‡**ï¼šå…³æ³¨æ•°æ®åº“å®¹é‡å’Œå¹¶å‘é™åˆ¶
3. **ä¼˜åŒ–æŸ¥è¯¢**ï¼šåˆç†ä½¿ç”¨ç´¢å¼•ï¼Œé¿å…å…¨è¡¨æ‰«æ
4. **æ•°æ®æ¸…ç†**ï¼šå®šæœŸæ¸…ç†è¿‡æœŸçš„æŠ½å¥–è®°å½•å’Œä¸´æ—¶æ•°æ®

---

ğŸ“ **å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒå¾®ä¿¡äº‘å¼€å‘å®˜æ–¹æ–‡æ¡£æˆ–è”ç³»æŠ€æœ¯æ”¯æŒ**